<!DOCTYPE html>
<html lang='en-US'><head><meta charset='UTF-8' /><title>Prompt - DUMPROWS</title><style>textarea { width: 99%; min-height: 150px; resize: vertical; }</style><script>var select, paragraph, div, button, controls, paragraphs = [], reader = new FileReader(), templates = [ { title: '' }, { title: 'Row Count', format: 'SELECT COUNT(*) FROM {Table}', params: ['Table'] }, { title: 'Unique Values', format: 'SELECT {Column}, COUNT(*) FROM {Table} GROUP BY {Column} ORDER BY 2 DESC', params: ['Table', 'Column'] } ]; function init() { select = document.getElementsByTagName('select')[0]; paragraph = document.getElementById('message'); div = document.getElementsByTagName('div')[0]; button = document.getElementsByTagName('button')[0]; controls = document.forms[0].elements; for (let n = templates.length, i = 0; i < n; ++i) addTemplate(templates[i]); } function loadTemplates(input) { reader.onloadend = function () { if (processTemplates(reader.result)) showMessage('Templates loaded successfully.', 'green'); else showMessage('Template file is invalid.', 'red'); }; reader.readAsText(input.files[0]); } function processTemplates(text) { if (!text) return true; var a, n, i, p, m, j; try { a = JSON.parse(text); } catch (ex) { console.error(ex); return false; } if (!Array.isArray(a)) return false; for (n = a.length, i = 0; i < n; ++i) { p = a[i]; if (!p.hasOwnProperty('title') || typeof p.title != 'string') return false; if (!p.hasOwnProperty('format') || typeof p.format != 'string') return false; if (!p.hasOwnProperty('params') || !Array.isArray(p.params)) return false; for (m = p.params.length, j = 0; j < m; ++j) if (typeof p.params[j] != 'string') return false; templates.push(p); addTemplate(p); } return true; } function addTemplate(template) { var p = document.createElement('option'); p.text = template.title; select.add(p); } function selectTemplate() { button.disabled = true; div.innerHTML = ''; if (!select.selectedIndex) return; var p, q, r, m, i, a = templates[select.selectedIndex].params, n = a.length; if (!n) { button.disabled = false; return; } for (m = paragraphs.length, i = 0; i < n; ++i) { if (m > i) { p = paragraphs[i]; q = p.firstChild; q.lastChild.value = ''; q.firstChild.textContent = a[i] + ': '; } else { p = document.createElement('p'); q = document.createElement('label'); q.textContent = a[i] + ': '; r = document.createElement('input'); r.type = 'text'; r.oninput = function (e) { for (var n = templates[select.selectedIndex].params.length, i = 0; i < n; ++i) if (!paragraphs[i].firstChild.lastChild.value.length) { button.disabled = true; return; } button.disabled = false; }; q.appendChild(r); p.appendChild(q); paragraphs.push(p); }; div.appendChild(p); } } function generateQuery() { var n, i, p = templates[select.selectedIndex], q = p.format, a = p.params; for (n = a.length, i = 0; i < n; ++i) q = q.replace(new RegExp('\{' + a[i] + '\}', 'g'), paragraphs[i].firstChild.lastChild.value); controls[0].value = q; controls[1].disabled = false; } function showMessage(text, color) { paragraph.textContent = text; paragraph.style.color = color; }</script></head><body onload='init()'><p>Query Templates: <select oninput='selectTemplate()'></select></p><p>Load query templates from file: <input type='file' oninput='loadTemplates(this)' /></p><p id='message'></p><fieldset><legend>Template Parameters</legend><div></div><button onclick='generateQuery()' disabled>Generate Query</button></fieldset><form><p>Query:<br /><textarea name='q' oninput='controls[1].disabled=!controls[0].value.length'></textarea></p><p><input type='submit' disabled /></p></form></body></html>
